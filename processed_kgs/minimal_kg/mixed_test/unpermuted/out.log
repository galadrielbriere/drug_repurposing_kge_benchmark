/home/galadriel/anaconda3/envs/benchmark/lib/python3.9/site-packages/ignite/handlers/checkpoint.py:16: DeprecationWarning: `TorchScript` support for functional optimizers is deprecated and will be removed in a future PyTorch release. Consider using the `torch.compile` optimizer instead.
  from torch.distributed.optim import ZeroRedundancyOptimizer
2024-10-08 13:42:46,170 - root - INFO - Configuration loaded:
{
    "common": {
        "seed": 42,
        "input_csv": "/home/galadriel/dr_benchmark/knowledge_graph/shep_kg_without_orphan_treatments.csv",
        "out": "/home/galadriel/dr_benchmark/processed_kgs/minimal_kg/mixed_test/unpermuted/",
        "run_kg_prep": true,
        "run_training": false,
        "run_evaluation": false
    },
    "clean_kg": {
        "remove_duplicates_triplets": true,
        "make_directed": true,
        "make_directed_params": [
            "disease_disease",
            "drug_drug",
            "protein_protein"
        ],
        "check_synonymous_antisynonymous": true,
        "check_synonymous_antisynonymous_params": {
            "theta1": 0.8,
            "theta2": 0.8
        },
        "permute_kg": false,
        "clean_train_set": true,
        "compute_proportions": true,
        "rel_swap": false,
        "mixed_test": true,
        "smaller_kg": true,
        "keep_relations": [
            "disease_disease",
            "protein_protein",
            "drug_drug",
            "phenotype_phenotype",
            "disease_protein",
            "indication",
            "disease_phenotype_positive",
            "disease_phenotype_negative",
            "drug_protein",
            "orpha_treatment"
        ]
    }
}
2024-10-08 13:42:46,170 - root - INFO - Setting number of threads to 20
2024-10-08 13:42:46,204 - root - INFO - Loading parameters from /home/galadriel/dr_benchmark/processed_kgs/minimal_kg/mixed_test/unpermuted/params.yaml
2024-10-08 13:42:46,205 - root - INFO - Output folder: /home/galadriel/dr_benchmark/processed_kgs/minimal_kg/mixed_test/unpermuted/
2024-10-08 13:42:46,205 - root - INFO - Preparing KG...
2024-10-08 13:42:54,438 - py.warnings - WARNING - /home/galadriel/dr_benchmark/dev/kg_processing.py:97: DtypeWarning: Columns (2,6) have mixed types. Specify dtype option on import or set low_memory=False.
  kg_df = pd.read_csv(input_file, sep="\t")[["my_x_id", "my_y_id", "relation"]]

2024-10-08 13:42:55,342 - root - INFO - Keeping only relations ['disease_disease', 'protein_protein', 'drug_drug', 'phenotype_phenotype', 'disease_protein', 'indication', 'disease_phenotype_positive', 'disease_phenotype_negative', 'drug_protein', 'orpha_treatment']
2024-10-08 13:44:00,016 - root - INFO - Removing duplicated triplets...
  0%|          | 0/9 [00:00<?, ?it/s] 11%|█         | 1/9 [00:00<00:01,  6.38it/s] 33%|███▎      | 3/9 [00:00<00:01,  3.57it/s]2024-10-08 13:44:01,071 - root - INFO - 52 duplicates found. Keeping 86247 unique triplets for relation 3
 44%|████▍     | 4/9 [00:01<00:01,  3.71it/s]2024-10-08 13:44:08,779 - root - INFO - 1336314 duplicates found. Keeping 1336314 unique triplets for relation 4
 56%|█████▌    | 5/9 [00:08<00:10,  2.73s/it]2024-10-08 13:44:08,886 - root - INFO - 185 duplicates found. Keeping 25468 unique triplets for relation 5
 67%|██████▋   | 6/9 [00:08<00:05,  1.89s/it]2024-10-08 13:44:09,018 - root - INFO - 16 duplicates found. Keeping 21909 unique triplets for relation 7
 89%|████████▉ | 8/9 [00:09<00:01,  1.02s/it]100%|██████████| 9/9 [00:09<00:00,  1.00s/it]100%|██████████| 9/9 [00:09<00:00,  1.11s/it]
2024-10-08 13:44:09,998 - root - INFO - Checking for synonymous and antisynonymous relations...
  0%|          | 0/9 [00:00<?, ?it/s] 11%|█         | 1/9 [00:01<00:10,  1.37s/it] 33%|███▎      | 3/9 [00:03<00:07,  1.18s/it] 44%|████▍     | 4/9 [00:04<00:05,  1.10s/it] 56%|█████▌    | 5/9 [00:22<00:26,  6.59s/it] 67%|██████▋   | 6/9 [00:22<00:13,  4.61s/it] 78%|███████▊  | 7/9 [00:22<00:06,  3.20s/it] 89%|████████▉ | 8/9 [00:23<00:02,  2.28s/it]100%|██████████| 9/9 [00:26<00:00,  2.64s/it]100%|██████████| 9/9 [00:26<00:00,  2.94s/it]
2024-10-08 13:44:36,479 - root - INFO - Finding duplicate relations
  0%|          | 0/36 [00:00<?, ?it/s] 56%|█████▌    | 20/36 [00:00<00:00, 199.66it/s]100%|██████████| 36/36 [00:00<00:00, 137.64it/s]
2024-10-08 13:44:36,741 - root - INFO - Duplicate relations: 0
2024-10-08 13:44:36,741 - root - INFO - Reverse duplicate relations: 0

2024-10-08 13:44:37,346 - root - INFO - Adding reverse triplets for relations disease_disease, drug_drug, protein_protein...
2024-10-08 13:44:37,381 - root - INFO - Adding created reverses ['disease_disease', 'drug_drug', 'protein_protein'] to the list of known duplicated relations.
2024-10-08 13:44:37,381 - root - INFO - Splitting the dataset into train, validation and test sets...
2024-10-08 13:44:44,403 - root - INFO - Entity coverage verified successfully.
2024-10-08 13:44:44,403 - root - INFO - Cleaning the train set to avoid data leakage...
2024-10-08 13:44:44,403 - root - INFO - Step 1: with respect to validation set.
2024-10-08 13:44:44,403 - root - INFO - Processing relation pair: (0, 9)
2024-10-08 13:45:13,286 - root - INFO - Found 2800 triplets to remove for relation 9 with reverse 0.
2024-10-08 13:45:39,542 - root - INFO - Found 2801 reverse triplets to remove for relation 0 with reverse 9.
2024-10-08 13:45:39,542 - root - INFO - Processing relation pair: (4, 10)
2024-10-08 13:46:06,282 - root - INFO - Found 106958 triplets to remove for relation 10 with reverse 4.
2024-10-08 13:46:33,081 - root - INFO - Found 106828 reverse triplets to remove for relation 4 with reverse 10.
2024-10-08 13:46:33,082 - root - INFO - Processing relation pair: (8, 11)
2024-10-08 13:46:59,119 - root - INFO - Found 25605 triplets to remove for relation 11 with reverse 8.
2024-10-08 13:47:23,629 - root - INFO - Found 25538 reverse triplets to remove for relation 8 with reverse 11.
2024-10-08 13:47:23,637 - root - INFO - Step 2: with respect to test set.
2024-10-08 13:47:23,637 - root - INFO - Processing relation pair: (0, 9)
2024-10-08 13:47:47,151 - root - INFO - Found 2820 triplets to remove for relation 9 with reverse 0.
2024-10-08 13:48:12,040 - root - INFO - Found 2819 reverse triplets to remove for relation 0 with reverse 9.
2024-10-08 13:48:12,040 - root - INFO - Processing relation pair: (4, 10)
2024-10-08 13:48:36,993 - root - INFO - Found 107076 triplets to remove for relation 10 with reverse 4.
2024-10-08 13:49:03,019 - root - INFO - Found 107206 reverse triplets to remove for relation 4 with reverse 10.
2024-10-08 13:49:03,019 - root - INFO - Processing relation pair: (8, 11)
2024-10-08 13:49:25,969 - root - INFO - Found 25667 triplets to remove for relation 11 with reverse 8.
2024-10-08 13:49:49,498 - root - INFO - Found 25734 reverse triplets to remove for relation 8 with reverse 11.
2024-10-08 13:49:50,111 - root - INFO - Entity coverage verification failed...
2024-10-08 13:49:50,333 - root - INFO - Total entities in full kg: 64057
2024-10-08 13:49:50,333 - root - INFO - Entities present in kg_train: 62155
2024-10-08 13:49:50,333 - root - INFO - Missing entities in kg_train: 1902
2024-10-08 13:49:50,368 - root - INFO - Warning: No triplet found involving entity '13' in kg_val or kg_test. Entity remains unconnected in kg_train.
2024-10-08 13:49:51,366 - root - INFO - Warning: No triplet found involving entity '360' in kg_val or kg_test. Entity remains unconnected in kg_train.
2024-10-08 13:49:53,160 - root - INFO - Warning: No triplet found involving entity '9053' in kg_val or kg_test. Entity remains unconnected in kg_train.
2024-10-08 13:49:56,781 - root - INFO - Warning: No triplet found involving entity '10618' in kg_val or kg_test. Entity remains unconnected in kg_train.
2024-10-08 13:49:57,312 - root - INFO - Warning: No triplet found involving entity '10819' in kg_val or kg_test. Entity remains unconnected in kg_train.
2024-10-08 13:49:58,461 - root - INFO - Warning: No triplet found involving entity '11490' in kg_val or kg_test. Entity remains unconnected in kg_train.
2024-10-08 13:54:58,841 - root - INFO - Warning: No triplet found involving entity '7281' in kg_val or kg_test. Entity remains unconnected in kg_train.
2024-10-08 13:55:51,444 - root - INFO - Warning: No triplet found involving entity '15832' in kg_val or kg_test. Entity remains unconnected in kg_train.
2024-10-08 13:57:25,928 - root - INFO - Entity coverage verified successfully.
2024-10-08 13:57:25,928 - root - INFO - Computing triplet proportions...
2024-10-08 13:57:25,981 - root - INFO - {0: {'train': 0.767148319853812, 'test': 0.11667963859091063, 'val': 0.11617204155527731}, 1: {'train': 0.8010788941335132, 'test': 0.100472016183412, 'val': 0.09844908968307485}, 2: {'train': 0.8004063174550462, 'test': 0.09979684127247687, 'val': 0.09979684127247687}, 3: {'train': 0.8005727735457465, 'test': 0.09963245098380233, 'val': 0.09979477547045115}, 4: {'train': 0.761858894393556, 'test': 0.1190701072816053, 'val': 0.11907099832483872}, 5: {'train': 0.8218941416679755, 'test': 0.08924925396576096, 'val': 0.08885660436626355}, 6: {'train': 0.8012422360248447, 'test': 0.0992616899097621, 'val': 0.09949607406539318}, 7: {'train': 0.8355013921219591, 'test': 0.08183851385275458, 'val': 0.08266009402528642}, 8: {'train': 0.7621709172989181, 'test': 0.11893863300259819, 'val': 0.11889044969848371}, 9: {'train': 0.767148319853812, 'test': 0.11647659977665731, 'val': 0.11637508036953065}, 10: {'train': 0.761858894393556, 'test': 0.11907099832483872, 'val': 0.1190701072816053}, 11: {'train': 0.7621709172989181, 'test': 0.11890527533051894, 'val': 0.11892380737056296}}
2024-10-08 13:57:25,982 - root - INFO - Saving results to /home/galadriel/dr_benchmark/processed_kgs/minimal_kg/mixed_test/unpermuted/kg.pkl...
