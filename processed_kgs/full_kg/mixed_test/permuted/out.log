/home/galadriel/anaconda3/envs/benchmark/lib/python3.9/site-packages/ignite/handlers/checkpoint.py:16: DeprecationWarning: `TorchScript` support for functional optimizers is deprecated and will be removed in a future PyTorch release. Consider using the `torch.compile` optimizer instead.
  from torch.distributed.optim import ZeroRedundancyOptimizer
2024-10-08 15:50:23,220 - root - INFO - Configuration loaded:
{
    "common": {
        "seed": 42,
        "input_csv": "/home/galadriel/dr_benchmark/knowledge_graph/shep_kg_without_orphan_treatments.csv",
        "out": "/home/galadriel/dr_benchmark/processed_kgs/full_kg/mixed_test/permuted",
        "run_kg_prep": true,
        "run_training": false,
        "run_evaluation": false
    },
    "clean_kg": {
        "remove_duplicates_triplets": true,
        "make_directed": true,
        "make_directed_params": [
            "disease_disease",
            "drug_drug",
            "protein_protein"
        ],
        "check_synonymous_antisynonymous": true,
        "check_synonymous_antisynonymous_params": {
            "theta1": 0.8,
            "theta2": 0.8
        },
        "permute_kg": true,
        "permute_kg_params": [
            "indication"
        ],
        "clean_train_set": true,
        "compute_proportions": true,
        "rel_swap": false,
        "mixed_test": true,
        "smaller_kg": false
    }
}
2024-10-08 15:50:23,220 - root - INFO - Setting number of threads to 20
2024-10-08 15:50:23,252 - root - INFO - Loading parameters from /home/galadriel/dr_benchmark/processed_kgs/full_kg/mixed_test/permuted/params.yaml
2024-10-08 15:50:23,252 - root - INFO - Output folder: /home/galadriel/dr_benchmark/processed_kgs/full_kg/mixed_test/permuted
2024-10-08 15:50:23,253 - root - INFO - Preparing KG...
2024-10-08 15:50:31,569 - py.warnings - WARNING - /home/galadriel/dr_benchmark/dev/kg_processing.py:97: DtypeWarning: Columns (2,6) have mixed types. Specify dtype option on import or set low_memory=False.
  kg_df = pd.read_csv(input_file, sep="\t")[["my_x_id", "my_y_id", "relation"]]

2024-10-08 15:52:17,693 - root - INFO - Removing duplicated triplets...
  0%|          | 0/30 [00:00<?, ?it/s]  7%|▋         | 2/30 [00:00<00:09,  2.91it/s] 13%|█▎        | 4/30 [00:00<00:04,  5.47it/s] 17%|█▋        | 5/30 [00:00<00:04,  5.98it/s] 23%|██▎       | 7/30 [00:01<00:05,  4.29it/s]2024-10-08 15:52:19,527 - root - INFO - 52 duplicates found. Keeping 86247 unique triplets for relation 7
 27%|██▋       | 8/30 [00:01<00:05,  4.20it/s]2024-10-08 15:52:27,021 - root - INFO - 1336314 duplicates found. Keeping 1336314 unique triplets for relation 8
 30%|███       | 9/30 [00:09<00:44,  2.13s/it] 33%|███▎      | 10/30 [00:10<00:37,  1.86s/it]2024-10-08 15:52:28,766 - root - INFO - 185 duplicates found. Keeping 25468 unique triplets for relation 10
 37%|███▋      | 11/30 [00:11<00:28,  1.51s/it] 43%|████▎     | 13/30 [00:11<00:14,  1.16it/s]2024-10-08 15:52:28,923 - root - INFO - 70 duplicates found. Keeping 2070 unique triplets for relation 14
 60%|██████    | 18/30 [00:11<00:04,  2.85it/s] 67%|██████▋   | 20/30 [00:11<00:02,  3.48it/s]2024-10-08 15:52:29,388 - root - INFO - 16 duplicates found. Keeping 21909 unique triplets for relation 21
 73%|███████▎  | 22/30 [00:11<00:01,  4.32it/s] 80%|████████  | 24/30 [00:11<00:01,  5.40it/s] 87%|████████▋ | 26/30 [00:12<00:00,  4.27it/s] 93%|█████████▎| 28/30 [00:13<00:00,  2.88it/s] 97%|█████████▋| 29/30 [00:19<00:01,  1.18s/it]100%|██████████| 30/30 [00:20<00:00,  1.18s/it]100%|██████████| 30/30 [00:20<00:00,  1.49it/s]
2024-10-08 15:52:38,006 - root - INFO - Checking for synonymous and antisynonymous relations...
  0%|          | 0/30 [00:00<?, ?it/s]  3%|▎         | 1/30 [00:00<00:05,  5.58it/s]  7%|▋         | 2/30 [00:01<00:17,  1.56it/s] 13%|█▎        | 4/30 [00:01<00:11,  2.25it/s] 17%|█▋        | 5/30 [00:02<00:12,  2.00it/s] 23%|██▎       | 7/30 [00:04<00:19,  1.21it/s] 27%|██▋       | 8/30 [00:05<00:18,  1.17it/s] 30%|███       | 9/30 [00:23<01:52,  5.34s/it] 33%|███▎      | 10/30 [00:24<01:24,  4.20s/it] 37%|███▋      | 11/30 [00:25<00:59,  3.15s/it] 40%|████      | 12/30 [00:25<00:41,  2.32s/it] 43%|████▎     | 13/30 [00:25<00:29,  1.71s/it] 47%|████▋     | 14/30 [00:25<00:20,  1.28s/it] 50%|█████     | 15/30 [00:26<00:14,  1.03it/s] 53%|█████▎    | 16/30 [00:26<00:10,  1.34it/s] 57%|█████▋    | 17/30 [00:26<00:07,  1.69it/s] 60%|██████    | 18/30 [00:27<00:06,  1.91it/s] 63%|██████▎   | 19/30 [00:27<00:05,  2.02it/s] 67%|██████▋   | 20/30 [00:27<00:04,  2.45it/s] 70%|███████   | 21/30 [00:27<00:03,  2.77it/s] 73%|███████▎  | 22/30 [00:28<00:03,  2.46it/s] 77%|███████▋  | 23/30 [00:28<00:02,  2.48it/s] 80%|████████  | 24/30 [00:29<00:02,  2.54it/s] 83%|████████▎ | 25/30 [00:30<00:03,  1.35it/s] 87%|████████▋ | 26/30 [00:31<00:03,  1.27it/s] 90%|█████████ | 27/30 [00:32<00:02,  1.15it/s] 93%|█████████▎| 28/30 [00:33<00:01,  1.34it/s] 97%|█████████▋| 29/30 [00:53<00:06,  6.66s/it]100%|██████████| 30/30 [00:59<00:00,  6.42s/it]100%|██████████| 30/30 [00:59<00:00,  1.98s/it]
2024-10-08 15:53:37,479 - root - INFO - Finding duplicate relations
  0%|          | 0/435 [00:00<?, ?it/s] 11%|█▏        | 49/435 [00:00<00:00, 477.05it/s] 22%|██▏       | 97/435 [00:00<00:00, 474.20it/s] 33%|███▎      | 145/435 [00:00<00:00, 407.99it/s] 43%|████▎     | 187/435 [00:00<00:00, 253.60it/s] 50%|█████     | 219/435 [00:00<00:00, 244.05it/s] 57%|█████▋    | 248/435 [00:01<00:01, 137.32it/s] 90%|████████▉ | 390/435 [00:01<00:00, 334.06it/s]100%|██████████| 435/435 [00:01<00:00, 266.52it/s]
2024-10-08 15:53:39,112 - root - INFO - Duplicate relations: 0
2024-10-08 15:53:39,112 - root - INFO - Reverse duplicate relations: 0

2024-10-08 15:53:40,279 - root - INFO - Making permutations for relation indication with id 17.
2024-10-08 15:54:03,017 - root - INFO - Adding reverse triplets for relations disease_disease, drug_drug, protein_protein...
2024-10-08 15:54:04,556 - root - INFO - Adding created reverses ['disease_disease', 'drug_drug', 'protein_protein'] to the list of known duplicated relations.
2024-10-08 15:54:04,556 - root - INFO - Splitting the dataset into train, validation and test sets...
2024-10-08 15:57:51,705 - root - INFO - Entity coverage verified successfully.
2024-10-08 15:57:51,705 - root - INFO - Cleaning the train set to avoid data leakage...
2024-10-08 15:57:51,705 - root - INFO - Step 1: with respect to validation set.
2024-10-08 15:57:51,705 - root - INFO - Processing relation pair: (4, 30)
2024-10-08 15:58:34,404 - root - INFO - Found 2826 triplets to remove for relation 30 with reverse 4.
2024-10-08 15:59:16,368 - root - INFO - Found 2842 reverse triplets to remove for relation 4 with reverse 30.
2024-10-08 15:59:16,368 - root - INFO - Processing relation pair: (8, 31)
2024-10-08 16:00:01,737 - root - INFO - Found 106848 triplets to remove for relation 31 with reverse 8.
2024-10-08 16:00:44,169 - root - INFO - Found 106990 reverse triplets to remove for relation 8 with reverse 31.
2024-10-08 16:00:44,169 - root - INFO - Processing relation pair: (29, 32)
2024-10-08 16:01:22,824 - root - INFO - Found 25702 triplets to remove for relation 32 with reverse 29.
2024-10-08 16:02:04,980 - root - INFO - Found 25714 reverse triplets to remove for relation 29 with reverse 32.
2024-10-08 16:02:04,989 - root - INFO - Step 2: with respect to test set.
2024-10-08 16:02:04,989 - root - INFO - Processing relation pair: (4, 30)
2024-10-08 16:02:43,197 - root - INFO - Found 2804 triplets to remove for relation 30 with reverse 4.
2024-10-08 16:03:23,183 - root - INFO - Found 2788 reverse triplets to remove for relation 4 with reverse 30.
2024-10-08 16:03:23,183 - root - INFO - Processing relation pair: (8, 31)
2024-10-08 16:04:05,771 - root - INFO - Found 107036 triplets to remove for relation 31 with reverse 8.
2024-10-08 16:04:48,290 - root - INFO - Found 106894 reverse triplets to remove for relation 8 with reverse 31.
2024-10-08 16:04:48,290 - root - INFO - Processing relation pair: (29, 32)
2024-10-08 16:05:26,396 - root - INFO - Found 25736 triplets to remove for relation 32 with reverse 29.
2024-10-08 16:06:05,678 - root - INFO - Found 25724 reverse triplets to remove for relation 29 with reverse 32.
2024-10-08 16:06:06,621 - root - INFO - Entity coverage verification failed...
2024-10-08 16:06:06,988 - root - INFO - Total entities in full kg: 134026
2024-10-08 16:06:06,988 - root - INFO - Entities present in kg_train: 132571
2024-10-08 16:06:06,988 - root - INFO - Missing entities in kg_train: 1455
2024-10-08 16:07:58,369 - root - INFO - Warning: No triplet found involving entity '62874' in kg_val or kg_test. Entity remains unconnected in kg_train.
2024-10-08 16:08:52,704 - root - INFO - Warning: No triplet found involving entity '64597' in kg_val or kg_test. Entity remains unconnected in kg_train.
2024-10-08 16:09:13,997 - root - INFO - Warning: No triplet found involving entity '57223' in kg_val or kg_test. Entity remains unconnected in kg_train.
2024-10-08 16:09:15,729 - root - INFO - Entity coverage verified successfully.
2024-10-08 16:09:15,729 - root - INFO - Computing triplet proportions...
2024-10-08 16:09:16,011 - root - INFO - {0: {'train': 0.9591647662485747, 'test': 0.019740592930444698, 'val': 0.021094640820980615}, 1: {'train': 0.8229399084823961, 'test': 0.08800060507506713, 'val': 0.08905948644253678}, 2: {'train': 0.8765737874097007, 'test': 0.05923632610939113, 'val': 0.06418988648090815}, 3: {'train': 0.799993075751281, 'test': 0.10002077274615705, 'val': 0.09998615150256197}, 4: {'train': 0.7662570664500186, 'test': 0.11675298737348093, 'val': 0.11698994617650045}, 5: {'train': 0.7997302764666218, 'test': 0.100472016183412, 'val': 0.09979770734996629}, 6: {'train': 0.8003721320922419, 'test': 0.09978707402596135, 'val': 0.09984079388179679}, 7: {'train': 0.8001901515415029, 'test': 0.09993391074472155, 'val': 0.09987593771377555}, 8: {'train': 0.7618933920155377, 'test': 0.11905330399223114, 'val': 0.11905330399223114}, 9: {'train': 0.8000050545256959, 'test': 0.09999115458003209, 'val': 0.10000379089427196}, 10: {'train': 0.8231506203863672, 'test': 0.08846395476676613, 'val': 0.08838542484686665}, 11: {'train': 0.8024615384615384, 'test': 0.09907692307692308, 'val': 0.09846153846153846}, 12: {'train': 0.8, 'test': 0.1, 'val': 0.1}, 13: {'train': 0.811142061281337, 'test': 0.0935933147632312, 'val': 0.09526462395543175}, 14: {'train': 0.8144927536231884, 'test': 0.09420289855072464, 'val': 0.09130434782608696}, 15: {'train': 0.8, 'test': 0.1111111111111111, 'val': 0.08888888888888889}, 16: {'train': 0.8003300330033003, 'test': 0.10066006600660066, 'val': 0.09900990099009901}, 17: {'train': 0.8015938122582913, 'test': 0.0992616899097621, 'val': 0.09914449783194657}, 18: {'train': 0.8829379696478562, 'test': 0.05827316929423899, 'val': 0.05878886105790482}, 19: {'train': 0.7997557997557998, 'test': 0.10012210012210013, 'val': 0.10012210012210013}, 20: {'train': 0.8106508875739645, 'test': 0.09388560157790928, 'val': 0.09546351084812624}, 21: {'train': 0.8363686156374093, 'test': 0.08156465379524397, 'val': 0.08206673056734676}, 22: {'train': 0.8000570450656018, 'test': 0.0999239399125309, 'val': 0.10001901502186727}, 23: {'train': 0.8005229546940212, 'test': 0.09976366470558656, 'val': 0.09971338060039221}, 24: {'train': 0.8005386554331687, 'test': 0.0997686543972929, 'val': 0.09969269016953834}, 25: {'train': 0.8005203712141196, 'test': 0.09975779957315173, 'val': 0.09972182921272871}, 26: {'train': 0.800819790018697, 'test': 0.09964044297425571, 'val': 0.09953976700704732}, 27: {'train': 0.8001922806359331, 'test': 0.09998593068517563, 'val': 0.09982178867889134}, 28: {'train': 0.8002546431537811, 'test': 0.09986477434177116, 'val': 0.09988058250444769}, 29: {'train': 0.7618576085626231, 'test': 0.1190749044085196, 'val': 0.11906748702885732}, 30: {'train': 0.7662570664500186, 'test': 0.11695609491892624, 'val': 0.11678683863105514}, 31: {'train': 0.7618933920155377, 'test': 0.11905241306807551, 'val': 0.11905419491638677}, 32: {'train': 0.7618576085626231, 'test': 0.1190749044085196, 'val': 0.11906748702885732}}
2024-10-08 16:09:16,012 - root - INFO - Saving results to /home/galadriel/dr_benchmark/processed_kgs/full_kg/mixed_test/permuted/kg.pkl...
